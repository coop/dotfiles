# xdg
source "${FRESH_LOCAL}/shell/config/xdg.sh"
mkdir -p $XDG_MAN_HOME/man1 $XDG_BIN_HOME

# fresh
fresh "freshshell/fresh" "bin/fresh" --bin

which_dist() {
  case $(uname -s) in
    Darwin) echo "mac";;
    Linux) echo "linux";;
  esac
}

fresh-dist() {
  local file="$1"

  fresh-options --ignore-missing
    fresh "$@"
    if echo "$file" | grep --quiet universal; then
      shift
      file=$(echo "$file" | sed "s,universal,$(which_dist),")

      fresh "$file" "$@"
    fi
  fresh-options
}

# install directories
asdf_install_dir="${XDG_DATA_HOME}/asdf"
less_history_dir="${XDG_CACHE_HOME}/less"
everydayhero_code_dir="${HOME}/Code/everydayhero"
bash_git_prompt_dir="${XDG_DATA_HOME}/bash-git-prompt"
vim_config_dir="${XDG_CONFIG_HOME}/vim"
vim_cache_dir="${XDG_CACHE_HOME}/vim"
vim_data_dir="${XDG_DATA_HOME}/vim"

# bash
for file in "${HOME}/.bash_profile" "${HOME}/.bashrc"; do
  fresh-options --file=$file --marker="#"
    fresh "shell/config/bashrc.sh"
    fresh "shell/config/xdg.sh"
    fresh "shell/functions/*.sh"
    fresh "shell/config/prompt.sh" --filter="sed s,INSTALL_DIR,$bash_git_prompt_dir,"
    fresh "shell/config/less.sh" --filter="sed s,INSTALL_DIR,$less_history_dir,"
    fresh "shell/config/history.sh"
    fresh "shell/config/case-insensitive-globbing.sh"
    fresh "shell/config/symlink.sh"
    fresh "chriskempson/base16-shell" "scripts/base16-tomorrow-night.sh"
    fresh "shell/config/fresh.sh"
    fresh "shell/config/editor.sh"
    fresh "shell/config/vim.sh" --filter="sed s,CONFIG_DIR,$vim_config_dir,"
    fresh "asdf/source.sh" --filter="sed s,INSTALL_DIR,$asdf_install_dir,"
    fresh "shell/config/clipboard.sh"
    fresh "shell/config/direnv.sh"
    fresh-dist "shell/config/coreutils.universal.sh"
    fresh "plain/source.sh" --filter="sed s,INSTALL_DIR,$everydayhero_code_dir,"
    fresh "shell/config/pssh.sh"
    fresh "shell/config/rg.sh"
  fresh-options
done

# scripts
fresh "bin/*" --bin

# asdf
$FRESH_LOCAL/asdf/install.sh "${asdf_install_dir}"

fresh-options --file="${HOME}/.asdfrc"
  fresh "asdf/legacy-version-file"
fresh-options

# less
$FRESH_LOCAL/less/create-history-directory.sh "${less_history_dir}"

# plain
$FRESH_LOCAL/plain/install.sh "${everydayhero_code_dir}"

# bash-git-prompt
$FRESH_LOCAL/bash-git-prompt/install.sh "${bash_git_prompt_dir}"

# vim
$FRESH_LOCAL/vim/install.sh "${vim_cache_dir}" "${vim_config_dir}" "${vim_data_dir}"

# chromedriver
$FRESH_LOCAL/chromedriver/install-chromedriver.sh

# ripgrep
$FRESH_LOCAL/rg/install-rg.sh

fresh-options --file="${vim_config_dir}/vimrc" --marker="\""
  fresh "vim/required.vim"
  fresh "vim/xdg.vim" --filter="sed s,CONFIG_DIR,$vim_config_dir,g | sed s,CACHE_DIR,$vim_cache_dir, | sed s,DATA_DIR,$vim_data_dir,"
  fresh "vim/vim-plug/before.vim" --filter="sed s,CONFIG_DIR,$vim_config_dir, | sed s,DATA_DIR,$vim_data_dir,g"
  fresh "vim/plugins/*.vim"
  fresh "vim/vim-plug/after.vim"
  fresh "vim/global.vim"
  fresh "vim/config/*.vim" --filter="sed s,CONFIG_DIR,$vim_config_dir, | sed s,CACHE_DIR,$vim_cache_dir,g"
  fresh "jasoncodes/dotfiles" "vim/config/fast_escape.vim"
  fresh "vim/mappings.vim"
  fresh "jasoncodes/dotfiles" "vim/mappings/disable-cursor-keys.vim"
fresh-options

# git
$FRESH_LOCAL/git/create-xdg-directories.sh
$FRESH_LOCAL/git/create-local-config.sh

fresh-options --file="${XDG_CONFIG_HOME}/git/config" --marker="#"
  fresh "git/config"
  fresh "git/include" --filter="sed s,XDG_CONFIG_HOME,$XDG_CONFIG_HOME,"
  fresh "git/alias"
  fresh "git/aliases/*"
fresh-options

fresh-options --file="${XDG_CONFIG_HOME}/git/ignore" --marker="#"
  fresh "github/gitignore" "Global/macOS.gitignore"
  fresh "github/gitignore" "Global/Tags.gitignore"
  fresh "github/gitignore" "Global/Vim.gitignore"
  fresh "github/gitignore" "Ruby.gitignore"
  fresh "github/gitignore" "Node.gitignore"
fresh-options

# alacritty
fresh-options --file="${XDG_CONFIG_HOME}/alacritty/alacritty.yml" --marker="#"
  fresh "alacritty/env.yml"
  fresh "alacritty/dimensions.yml"
  fresh "alacritty/dpi.yml"
  fresh "alacritty/tabspaces.yml"
  fresh "alacritty/fonts.yml"
  fresh "alacritty/render-timer.yml"
  fresh "alacritty/cursor.yml"
  fresh "alacritty/colors.yml"
  fresh "alacritty/visual-bell.yml"
  fresh "alacritty/key-bindings.yml"
  fresh "alacritty/mouse.yml"
  fresh "alacritty/shell.yml"
fresh-options

fresh_after_build() {
  $FRESH_LOCAL/asdf/install-plugins.sh
  $FRESH_LOCAL/vim/vim-plug/plug-install.sh
  $FRESH_LOCAL/vim/vim-plug/plug-clean.sh
  $FRESH_LOCAL/hub/install-hub.sh
  $FRESH_LOCAL/docker/install-docker-compose.sh
}
